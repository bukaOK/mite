
@{
    ViewBag.Title = "Персонажи";
}
<div class="ui stackable grid">
    <div class="five wide column">
        <div class="ui vertical menu" id="userCharactersItems">
            <a class="active item" data-tab="all">Все</a>
            <a class="item" data-tab="own">Созданные мной</a>
            <div class="item" id="originalFilter">
                <div class="ui checkbox">
                    <input type="checkbox" />
                    <label>Оригинальный персонаж</label>
                </div>
            </div>
        </div>
    </div>
    <div class="eleven wide column">
        <div class="ui segment">
            <h3 class="ui dividing header">Персонажи</h3>
            <div class="ui input">
                <input type="text" id="characterSearch" />
            </div>
            <div class="ui tab" data-tab="all">
                <div class="ui items"></div>
            </div>
            <div class="ui tab" data-tab="own">
                <div class="ui items"></div>
            </div>
            <div class="dot-loader-wrapper">
                <div class="dot-loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/x-jsrender" id="characterItemTmpl">
    <div class="item">
        <div class="image">
            <img src="{{:ImageSrc}}" />
        </div>
        <div class="content">
            <a class="header">{{:Name}}</a>
            {{if !User}}
            <a class="ui primary label" href="@Url.Action("Edit", "Character")/{{:Id}}">Редактировать</a>
            {{/if}}
            <div class="description">{{:Description}}</div>
            {{if User}}
            <div class="extra">
                <img src="{{:User.AvatarSrc}}" class="ui avatar image" />
                <a href="/user/profile/{{:User.UserName}}">{{:User.UserName}}</a>
            </div>
        </div>
    </div>
</script>
<script type="text/html" id="emptyCharacterTmpl">
    <h3 class="ui center aligned icon header" style="color: #6D6788; margin-top: 20px;">
        <i class="meh outline icon"></i>
        <span class="content">
            Работы не найдены.
        </span>
    </h3>
</script>
<script>
    var characterTmpl = $.templates('#characterItemTmpl');
    var characterItems = $('#characterItems');

    var allTab = new Tab({
        parentTab: null,
        name: 'all',
        isActive: true,
    });
    var ownTab = new Tab({
        parentTab: null,
        name: 'own',
        isActive: false,
    });
    TabFilter.Tabs.items.push(allTab, publishedTab);
    TabFilter.Filters.add({
        name: 'input',
        elem: $('#characterSearch'),
        getVal: function () {
            return this.elem.val();
        },
        updateState: function (newVal) {
            this.elem.val(newVal);
        }
    });
    TabFilter.Filters.add({
        name: 'input',
        elem: $('#originalFilter>.checkbox'),
        getVal: function () {
            return this.elem.checkbox('is checked');
        },
        updateState: function (newVal) {
            newVal ? this.elem.checkbox('set checked') : this.elem.checkbox('set unchecked');
        }
    });
    TabFilter.init('@Url.Action("Characters", "Character")', {
        onSuccess: function (resp, tab) {
            var html;
            if (resp.length == 0 && TabFilter.page == 1) {
                html = $('#emptyCharacterTmpl').html();
                tab.content.html(html);
                $('.dot-loader-wrapper').removeClass('active');
            } else if (resp.length > 0) {
                html = characterTmpl.render(resp);

                if (TabFilter.loadNextPage) {
                    tab.content.append(html);
                } else {
                    tab.content.html(html);
                }
            }
        },
        onError: function () {
            $('footer').removeClass('active');
            iziToast.error({
                title: 'Упс...',
                message: 'Ошибка при загрузке работ'
            });
        },
        ajax: {
            type: 'post'
        }
    });
    Scrolling.init('.dot-loader-wrapper', function () {
        if (!TabFilter.loading) {
            var lastTab = TabFilter.Tabs.getLastActiveTab();
            TabFilter.loadNext();
        }
    });
</script>

