@using Mite.Extensions
@model Mite.Models.TariffModel

@{
    ViewBag.Title = Model.Id == null ? "Добавить тариф" : "Редактировать тариф";
    var saveUrl = Model.Id == null ? Url.Action("Add", "Tariff") : Url.Action("Update", "Tariff");
}
<div class="ui center aligned grid">
    <div class="left aligned ten wide column">
        <div class="ui segment">
            <h2 class="ui dividing header">@ViewBag.Title</h2>
            <form class="ui form" id="tariffEditForm">
                @Html.HiddenFor(x => x.Id)
                @Html.EditorFor(x => x.Header, new { WithLabel = true })
                @Html.EditorFor(x => x.Price, new { WithLabel = true })
                <div class="field">
                    <label>Описание</label>
                    <div id="editor">
                        @if (!string.IsNullOrEmpty(Model.Description))
                        {
                            @Html.Raw(Model.Description)
                        }
                    </div>
                </div>
                <button class="ui green button" id="saveBtn" type="button">Сохранить</button>
                <div class="ui green m-success message">Тариф сохранен</div>
                <div class="ui error message"></div>
            </form>
        </div>
    </div>
</div>
@section scripts{
@Scripts.Render("~/bundles/editor", "~/bundles/api")
@Styles.Render("~/Content/editor")
<script>
    @Html.Raw(Html.FormValidation("#tariffEditForm"))
    ClassicEditor.create($('#editor')[0], {
        removePlugins: ['blockQuote', 'alignment', 'save'],
        toolbar: ['heading', '|', 'bold', 'italic', 'link', 'bulletedList', 'numberedList', 'imageUpload'],
        language: 'ru',
        heading: {
            options: [
                { model: 'paragraph', title: 'Параграф', class: 'ck-heading_paragraph' },
                { model: 'heading2', view: 'h2', title: 'Заголовок', class: 'ck-heading_heading2' }
            ]
        },
        miteUpload: {
            uploadUrl: '@Url.Action("UploadDocImg", "Files", new { maxWidth = 1200 })'
        },
        save: {
            callback: function (data) {
                return TariffMvc.save('@saveUrl', $('#saveBtn')[0]);
            }
        }
    }).then(function (editor) {
        $('#saveBtn').click(function () {
            TariffMvc.save('@saveUrl', editor.getData(), this);
        });
    }).catch (function (error) {
        console.error(error);
    });
</script>
}
